<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2009 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<div class="header-container">
    <div class="header">
		<div class="container_12">
			<div class="grid_12">
				<a href="<?php echo $this->getUrl('') ?>"><img src="<?=$this->getSkinUrl('images/logo.jpg');?>" alt="No Tomatoes - Life is good by" class="logo" /></a>
				<!--<img src="<?=$this->getSkinUrl('images/zevende_hemel.gif');?>" alt="de Zevende Hemel" class="text" />-->
				<p id="site-title">
        <?php
          if (isset($_COOKIE['PAPVisitorId'])) {
            require_once("/home/notomatoes/domains/webstore.no-tomatoes.com/public_html/affiliate/api/PapApi.class.php");
            try {
              // login to API
              $session = new Gpf_Api_Session("http://webstore.no-tomatoes.com/affiliate/scripts/server.php");
              if(!$session->login("maurice@no-tomatoes.com", "n0t0mat0es")) {
                //die("Cannot login. Message: ".$session->getMessage());
              }

              $visitorId = $_COOKIE['PAPVisitorId'];
              $request = new Gpf_Rpc_GridRequest('Pap_Merchants_Tools_VisitorAffiliatesGrid', "getRows", $session);
              $request->addFilter("visitorid", "=", $visitorId);
              try {
                $request->sendNow();
              } catch(Exception $e) {
                //die("API call error: ".$e->getMessage());
              }

              $grid = $request->getGrid();
              $recordset = $grid->getRecordset();
              foreach($recordset as $rec) {
                if ($rec->get('rtype') == "A") {
                  $affiliate = new Pap_Api_Affiliate($session);
                  $affiliate->setUserid($rec->get('userid')); // load aff
                  try {
                    $affiliate->load();
                  } catch (Exception $e) {
                    //die("Cannot load record: ".$affiliate->getMessage());
                  }
                  
                  echo $affiliate->getData(2);
                  $pap_res = '<div style="display: block; margin: 0 auto 20px; width: 940px;">'."\n";
                  $pap_res .= $affiliate->getData(2)."<br />\n";
                  $pap_res .= $affiliate->getData(3)."<br />\n";
                  $pap_res .= $affiliate->getData(7)." ".$affiliate->getData(4)."<br />\n</div>";
                }
              }
            } catch(Exception $e) {
                $pap_res = "official store";
            }
          }
          else {
            $pap_res = "official store";
          }
        ?>
        </p>
				<div class="options-menu">
					<?php echo $this->getChildHtml('topLinks') ?>
					<?php echo $this->getChildHtml('store_language') ?>
				</div>
				<?php echo $this->getChildHtml('topContainer'); ?>
				<div class="clear">&nbsp;</div>
				<p class="title">Welkom in de officiele no tomatoes webstore</p>
				<?php
					echo $this->getChildHtml('breadcrumbs') ?>
			</div>
		</div>
    </div>
</div>
<?php echo $this->getChildHtml('topMenu') ?>
